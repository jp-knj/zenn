---
title: "åˆ†ã‹ã£ãŸæ°—ã«ãªã‚‹Dynamic Import"
emoji: "ğŸ“š"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ['javascript', 'typescript', 'react', 'webãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹', 'ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ”¹å–„']
published: true 
---

# ã¯ã˜ã‚ã« 
**Dynamic Import** ã¯å¿…è¦ãªæ™‚ã«ã€å¿…è¦ãªãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¿ã¾ã™ã€‚

**Dynamic Import**ã®ä½¿ç”¨ã‚’æ¤œè¨ã™ã‚‹å¿…è¦ãŒã‚ã‚‹æ¤œè¨ç®‡æ‰€ã‚’è¤‡æ•°è¿°ã¹ã¾ã™ã€‚
- `static import`ã™ã‚‹ã¨ã€ã‚³ãƒ¼ãƒ‰ã®èª­ã¿è¾¼ã¿ãŒå¤§å¹…ã«é…ããªã‚Šã€ã‚¤ãƒ³ãƒãƒ¼ãƒˆã™ã‚‹ã‚³ãƒ¼ãƒ‰ãŒå¿…è¦ã«ãªã‚‹å¯èƒ½æ€§ãŒä½ããªã‚‹ã‹ã€å¾Œã§å¿…è¦ã«ãªã‚‹å¯èƒ½æ€§ãŒä½ããªã‚Šã¾ã™ã€‚
- `static import`ã™ã‚‹ã¨ã€ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®ãƒ¡ãƒ¢ãƒªãƒ¼ä½¿ç”¨é‡ãŒå¤§å¹…ã«å¢—åŠ ã—ã€ã‚¤ãƒ³ãƒãƒ¼ãƒˆã™ã‚‹ã‚³ãƒ¼ãƒ‰ãŒå¿…è¦ã«ãªã‚‹å¯èƒ½æ€§ãŒä½ããªã‚Šã¾ã™ã€‚
- èª­ã¿è¾¼ã¿æ™‚ã«èª­ã¿è¾¼ã‚€ãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã—ãªã„ã‚±ãƒ¼ã‚¹
- èª­ã¿è¾¼ã‚€ãƒ•ã‚¡ã‚¤ãƒ«ã«å‰¯ä½œç”¨ãŒã‚ã‚Šã€ã‚ã‚‹æ¡ä»¶ãŒ`true`ã§ã¯ãªã„é™ã‚Šã€ãã®å‰¯ä½œç”¨ã‚’æœ›ã¾ãªã„å ´åˆã€‚ï¼ˆãƒ•ã‚¡ã‚¤ãƒ«ã«å‰¯ä½œç”¨ãŒãªã„ã“ã¨ã‚’æ¨å¥¨ã—ã¾ã™ãŒã€ãƒ•ã‚¡ã‚¤ãƒ«ã®ä¾å­˜é–¢ä¿‚ã§ã“ã‚Œã‚’åˆ¶å¾¡ã§ããªã„å ´åˆãŒã‚ã‚Šã¾ã™ã€‚ï¼‰

ã™ã¹ã¦ã®å ´åˆã«ãŠã„ã¦ã€Dynamic import ã‚’ä½¿ç”¨ã™ã‚‹ã®ã¯è³¢ã„åˆ¤æ–­ã§ã¯ãªãã€Dynamic import ã¯å¿…è¦ãªå ´åˆã«ã®ã¿ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚
åˆæœŸã®ä¾å­˜é–¢ä¿‚ã‚’ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ã«ã¯**static import**ãŒé©ã—ã¦ã„ã¦ã€**tree shaking**ã®æ©æµã‚’ã‚ˆã‚Šã‚ˆãå—ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

ã§ã™ãŒã€ã“ã®èª¬æ˜ã ã‘ã ã¨åˆ†ã‹ã£ãŸæ°—ã«ã¯ãªã‚Œã¾ã›ã‚“ã­ã€‚
å…·ä½“çš„ãªã‚±ãƒ¼ã‚¹ã‚’æŒ™ã’ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

## å…·ä½“çš„ã«è€ƒãˆã‚ˆã† 

ä»Šå›ã®ãƒãƒ£ãƒƒãƒˆã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã¯ã€4ã¤ã®é‡è¦ãªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒã‚ã‚Šã¾ã™ã€‚`UserInfo`ã€`ChatList`ã€`ChatInput`ã€`EmojiPicker`ã§ã™ã€‚

ã—ã‹ã—ã€ã“ã‚Œã‚‰ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ã†ã¡ã€æœ€åˆã®ãƒšãƒ¼ã‚¸ã®èª­ã¿è¾¼ã¿æ™‚ã«å³åº§ã«ä½¿ç”¨ã•ã‚Œã‚‹ã®ã¯ã€3ã¤ã ã‘ã§`UserInfo`ã€`ChatList`ã€`ChatInput`ã§ã™ã€‚

`EmojiPicker` ã¯ç›´æ¥è¡¨ç¤ºã•ã‚Œãšã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒ `EmojiPicker` ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹ãŸã‚ã« Emoji ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãªã„å ´åˆã¯ã€ã¾ã£ãŸãæç”»ã•ã‚Œãªã„å¯èƒ½æ€§ã‚‚ã‚ã‚Šã¾ã™ã€‚
ã“ã®å ´åˆã€`EmojiPickerãƒ•ã‚¡ã‚¤ãƒ«`ã‚’åˆæœŸãƒãƒ³ãƒ‰ãƒ«ã«è¿½åŠ ã™ã‚‹ã“ã¨ã«ãªã‚Šã€èª­ã¿è¾¼ã¿æ™‚é–“ãŒé•·ããªã‚‹å¯èƒ½æ€§ã‚’é«˜ãã—ã¦ã—ã¾ã„ã¾ã—ãŸã€‚

ã“ã‚Œã‚’è§£æ±ºã™ã‚‹ãŸã‚ã«ã€`EmojiPickerã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ`ã‚’å‹•çš„ã«èª­ã¿è¾¼ã‚€ã“ã¨ãŒã§ãã¾ã™(Dynamic import)ã€‚

é™çš„ã«èª­ã¿è¾¼ã‚€ã®ã§ã¯ãªãã€EmojiPickerã‚’è¡¨ç¤ºã™ã‚‹ã¨ãã ã‘èª­ã¿è¾¼ã‚€ã®ã§ã™ã€‚

## CSR ã§ Dynamic import
Reactã§ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’å‹•çš„ã«èª­ã¿è¾¼ã‚€ç°¡å˜ãªæ–¹æ³•ã¯ã€**React Suspense**ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã™ã€‚
React.Suspensionã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¯ã€å‹•çš„ã«èª­ã¿è¾¼ã‚€ã¹ãã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’å—ã‘å–ã‚Šã€EmojiPickerãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã‚’ä¸€æ™‚åœæ­¢ã™ã‚‹ã“ã¨ã§ã€Appã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’ã‚ˆã‚Šé€Ÿãæç”»ã™ã‚‹ã“ã¨ã‚’ã§ãã¾ã™ã€‚
React.Suspensionã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¯ã€`EmojiPickerã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ`ã®èª­ã¿è¾¼ã¿ã‚’ä¸€æ™‚åœæ­¢ã—ã¾ã™ã€‚
ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒçµµæ–‡å­—ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ã€`EmojiPickerã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ`ãŒåˆã‚ã¦æç”»ã•ã‚Œã‚‹ã€‚
`EmojiPickerã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ`ã¯ `Suspenseã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ`ã‚’æç”»ã—ã€ã“ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒé…å»¶ã‚¤ãƒ³ãƒãƒ¼ãƒˆã•ã‚ŒãŸãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ« (ã“ã®å ´åˆã¯ EmojiPicker) ã‚’å—ã‘å–ã‚Šã¾ã™ã€‚Suspense ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¯ã€fallback prop ã‚’å—ã‘å–ã‚Šã€suspended ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ãƒ­ãƒ¼ãƒ‰ä¸­ã«ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã•ã‚Œã‚‹ã¹ãã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’å—ã‘å–ã‚Šã¾ã™ã€‚

EmojiPicker ã‚’ä¸è¦ã«åˆæœŸãƒãƒ³ãƒ‰ãƒ«ã«è¿½åŠ ã™ã‚‹ä»£ã‚ã‚Šã«ã€ç‹¬è‡ªã®ãƒãƒ³ãƒ‰ãƒ«ã«åˆ†å‰²ã—ã€åˆæœŸãƒãƒ³ãƒ‰ãƒ«ã®ã‚µã‚¤ã‚ºã‚’å°ã•ãã™ã‚‹ã“ã¨ãŒã§ãã¾ã™!

åˆæœŸãƒãƒ³ãƒ‰ãƒ«ã‚µã‚¤ã‚ºãŒå°ã•ããªã‚Œã°ã€åˆæœŸãƒ­ãƒ¼ãƒ‰ãŒé€Ÿããªã‚Šã¾ã™ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ã€é•·ã„é–“ã€ç©ºç™½ã®ãƒ­ãƒ¼ãƒ‰ç”»é¢ã‚’è¦‹ã¤ã‚ã‚‹å¿…è¦ãŒãªããªã‚Šã¾ã™ã€‚
`fallbackã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ`ã¯ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒãƒ•ãƒªãƒ¼ã‚ºã—ã¦ã„ãªã„ã“ã¨ã‚’ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«çŸ¥ã‚‰ã›ã¾ã™ï¼šãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ã€ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒå‡¦ç†ã•ã‚Œå®Ÿè¡Œã•ã‚Œã‚‹ã¾ã§å°‘ã—å¾…ã¤å¿…è¦ãŒã‚ã‚‹ã ã‘ã§ã™ã€‚

```shell
Asset                             Size         Chunks            Chunk Names
emoji-picker.bundle.js           1.48 KiB      1    [emitted]    emoji-picker
main.bundle.js                   1.33 MiB      main [emitted]    main
vendors~emoji-picker.bundle.js   171 KiB       2    [emitted]    vendors~emoji-picker
```

å¾“æ¥ã¯åˆæœŸãƒãƒ³ãƒ‰ãƒ«ãŒ1.5MiBã ã£ãŸã®ã«å¯¾ã—ã€EmojiPickerã®èª­ã¿è¾¼ã¿ã‚’Suspence(åœæ­¢)ã™ã‚‹ã“ã¨ã§ã€1.33MiBã«æ¸›ã‚‰ã™ã“ã¨ãŒã§ãã¾ã—ãŸã€‚

ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§ã¯ã€EmojiPickerã‚’ toggle ã™ã‚‹ã¾ã§å®Ÿè¡Œã•ã‚Œãªã„ã“ã¨ãŒåˆ†ã‹ã‚Šã¾ã™
```javascript
import React, { Suspense, lazy } from "react";
// import Send from "./icons/Send";
// import Emoji from "./icons/Emoji";
const Send = lazy(() =>
import(/*webpackChunkName: "send-icon" */ "./icons/Send")
);
const Emoji = lazy(() =>
import(/*webpackChunkName: "emoji-icon" */ "./icons/Emoji")
);
// Lazy load EmojiPicker  when <EmojiPicker /> renders
const Picker = lazy(() =>
import(/*webpackChunkName: "emoji-picker" */ "./EmojiPicker")
);

const ChatInput = () => {
const [pickerOpen, togglePicker] = React.useReducer(state => !state, false);

    return (
      <Suspense fallback={<p id="loading">Loading...</p>}>
        <div className="chat-input-container">
          <input type="text" placeholder="Type a message..." />
          <Emoji onClick={togglePicker} />
          {pickerOpen && <Picker />}
          <Send />
        </div>
      </Suspense>
    );
};

console.log("ChatInput loaded", Date.now());

export default ChatInput;
```

ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ãƒ“ãƒ«ãƒ‰ã™ã‚‹ã¨ã€WebpackãŒä½œæˆã—ãŸã•ã¾ã–ã¾ãªãƒãƒ³ãƒ‰ãƒ«ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

`EmojiPickerã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ`ã‚’å‹•çš„ã«èª­ã¿è¾¼ã‚€ã“ã¨ã§ã€æœ€åˆã®ãƒãƒ³ãƒ‰ãƒ«ã‚µã‚¤ã‚ºã‚’ 1.5MiB ã‹ã‚‰ 1.33MiB ã«æ¸›ã‚‰ã™ã“ã¨ã«æˆåŠŸã—ã¾ã—ãŸ! 
`EmojiPicker` ãŒå®Œå…¨ã«èª­ã¿è¾¼ã¾ã‚Œã‚‹ã¾ã§ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ã¾ã ã—ã°ã‚‰ãå¾…ãŸãªã‘ã‚Œã°ãªã‚Šã¾ã›ã‚“ãŒã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®èª­ã¿è¾¼ã¿ã‚’å¾…ã£ã¦ã„ã‚‹é–“ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒæç”»ã•ã‚Œã€ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ã«ãªã‚‹ã‚ˆã†ã«ã™ã‚‹ã“ã¨ã§ã€UXã‚’å‘ä¸Šã•ã›ã‚‹ã“ã¨ãŒã§ãã¾ã—ãŸã€‚
![](/images/dynamic-import.png)
##  

## loadable components 
SSR(ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°)ã¯ã¾ã React Suspenseã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã›ã‚“ã€‚
React Suspenseã«ä»£ã‚ã‚‹ã‚‚ã®ã¨ã—ã¦ã€`loadable-componentsãƒ©ã‚¤ãƒ–ãƒ©ãƒª`ãŒã‚ã‚Šã€SSR ã§ä½¿ç”¨ã§ãã¾ã™ã€‚

```javascript
import React from "react";
import loadable from "@loadable/component";

import Send from "./icons/Send";
import Emoji from "./icons/Emoji";

const EmojiPicker = loadable(() => import("./EmojiPicker"), {
  fallback: <div id="loading">Loading...</div>
});

const ChatInput = () => {
  const [pickerOpen, togglePicker] = React.useReducer(state => !state, false);

  return (
    <div className="chat-input-container">
      <input type="text" placeholder="Type a message..." />
      <Emoji onClick={togglePicker} />
      {pickerOpen && <EmojiPicker />}
      <Send />
    </div>
  );
};

export default ChatInput;
```

React Suspense ã¨åŒæ§˜ã«ã€`lazy import`ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’ loadable ã«æ¸¡ã™ã“ã¨ã§ã€`EmojiPickerãƒ•ã‚¡ã‚¤ãƒ«`ãŒãƒªã‚¯ã‚¨ã‚¹ãƒˆã•ã‚ŒãŸã¨ãã ã‘ã€ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¿ã¾ã™ã€‚
ãƒ•ã‚¡ã‚¤ãƒ«ãŒèª­ã¿è¾¼ã¿ã•ã‚Œã¦ã„ã‚‹é–“ã€fallbackã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’æç”»ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

loadable ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¯ SSR ã§ React Suspense ã«ä»£ã‚ã‚‹ç´ æ™´ã‚‰ã—ã„æ–¹æ³•ã§ã™ãŒã€CSR ã§ã‚‚ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã‚’ä¸€æ™‚åœæ­¢ã™ã‚‹ãŸã‚ã«æœ‰ç”¨ãã†ã§ã™ã­ã€‚
```javascript
import React from "react";
  import Send from "./icons/Send";
  import Emoji from "./icons/Emoji";
  import loadable from "@loadable/component";

  const EmojiPicker = loadable(() => import("./components/EmojiPicker"), {
    fallback: <p id="loading">Loading...</p>
  });

  const ChatInput = () => {
    const [pickerOpen, togglePicker] = React.useReducer(state => !state, false);

    return (
      <div className="chat-input-container">
        <input type="text" placeholder="Type a message..." />
        <Emoji onClick={togglePicker} />
        {pickerOpen && <EmojiPicker />}
        <Send />
      </div>
    );
  };

  console.log("ChatInput loaded", Date.now());

  export default ChatInput;
```

[ã“ã¡ã‚‰](https://www.patterns.dev/posts/dynamic-import/)ã®è¨˜äº‹ã‚’å‚è€ƒã«ã—ã¦ãŠã‚Šã¾ã™ã€‚(ã¨ã¦ã‚‚é¢ç™½ã„è¨˜äº‹ã§ã™ã®ã§ã€ãœã²ä¸€èª­ã—ã¦ã¿ã¦ãã ã•ã„)