---
title: ""
emoji: "ðŸ“š"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: []
published: false
---

## ãƒ€ã‚¤ãƒŠãƒŸãƒƒã‚¯ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
ã‚ªãƒ³ãƒ‡ãƒžãƒ³ãƒ‰ã§ã‚³ãƒ¼ãƒ‰ã®ä¸€éƒ¨ã‚’å–ã‚Šè¾¼ã‚€

ä»Šå›žã®ãƒãƒ£ãƒƒãƒˆã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã¯ã€4ã¤ã®é‡è¦ãªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒã‚ã‚Šã¾ã™ã€‚UserInfoã€ChatListã€ChatInputã€EmojiPickerã§ã™ã€‚ã—ã‹ã—ã€ã“ã‚Œã‚‰ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ã†ã¡ã€æœ€åˆã®ãƒšãƒ¼ã‚¸ãƒ­ãƒ¼ãƒ‰æ™‚ã«å³åº§ã«ä½¿ç”¨ã•ã‚Œã‚‹ã®ã¯ã€3ã¤ã ã‘ã§ã™ã€‚UserInfoã€ChatListã€ChatInputã§ã™ã€‚EmojiPicker ã¯ç›´æŽ¥è¡¨ç¤ºã•ã‚Œãšã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒ EmojiPicker ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹ãŸã‚ã« Emoji ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãªã„å ´åˆã¯ã€ã¾ã£ãŸããƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã•ã‚Œãªã„å¯èƒ½æ€§ã‚‚ã‚ã‚Šã¾ã™ã€‚ã“ã®å ´åˆã€EmojiPicker ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ä¸å¿…è¦ã«åˆæœŸãƒãƒ³ãƒ‰ãƒ«ã«è¿½åŠ ã™ã‚‹ã“ã¨ã«ãªã‚Šã€ãƒ­ãƒ¼ãƒ‰æ™‚é–“ãŒé•·ããªã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™!

ã“ã‚Œã‚’è§£æ±ºã™ã‚‹ãŸã‚ã«ã€EmojiPickerã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’å‹•çš„ã«ã‚¤ãƒ³ãƒãƒ¼ãƒˆã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚é™çš„ã«ã‚¤ãƒ³ãƒãƒ¼ãƒˆã™ã‚‹ã®ã§ã¯ãªãã€EmojiPickerã‚’è¡¨ç¤ºã™ã‚‹ã¨ãã ã‘ã‚¤ãƒ³ãƒãƒ¼ãƒˆã™ã‚‹ã®ã§ã™ã€‚Reactã§ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’å‹•çš„ã«ã‚¤ãƒ³ãƒãƒ¼ãƒˆã™ã‚‹ç°¡å˜ãªæ–¹æ³•ã¯ã€React Suspenseã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã™ã€‚React.Suspensionã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¯ã€å‹•çš„ã«ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã‚‹ã¹ãã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’å—ã‘å–ã‚Šã€EmojiPickerãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚’ä¸€æ™‚åœæ­¢ã™ã‚‹ã“ã¨ã§ã€Appã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’ã‚ˆã‚Šé€Ÿããƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã™ã‚‹ã“ã¨ã‚’å¯èƒ½ã«ã—ã¾ã™ï¼React.Suspensionã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¯ã€EmojiPickerãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚’ä¸€æ™‚åœæ­¢ã—ã¾ã™ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒçµµæ–‡å­—ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ã€EmojiPicker ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒåˆã‚ã¦ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã•ã‚Œã¾ã™ã€‚EmojiPicker ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¯ Suspense ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã—ã€ã“ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒé…å»¶ã‚¤ãƒ³ãƒãƒ¼ãƒˆã•ã‚ŒãŸãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ« (ã“ã®å ´åˆã¯ EmojiPicker) ã‚’å—ã‘å–ã‚Šã¾ã™ã€‚Suspense ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¯ã€fallback prop ã‚’å—ã‘å–ã‚Šã€suspended ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ãƒ­ãƒ¼ãƒ‰ä¸­ã«ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã•ã‚Œã‚‹ã¹ãã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’å—ã‘å–ã‚Šã¾ã™ã€‚

EmojiPicker ã‚’ä¸å¿…è¦ã«åˆæœŸãƒãƒ³ãƒ‰ãƒ«ã«è¿½åŠ ã™ã‚‹ä»£ã‚ã‚Šã«ã€ç‹¬è‡ªã®ãƒãƒ³ãƒ‰ãƒ«ã«åˆ†å‰²ã—ã€åˆæœŸãƒãƒ³ãƒ‰ãƒ«ã®ã‚µã‚¤ã‚ºã‚’å°ã•ãã™ã‚‹ã“ã¨ãŒã§ãã¾ã™!

åˆæœŸãƒãƒ³ãƒ‰ãƒ«ã‚µã‚¤ã‚ºãŒå°ã•ããªã‚Œã°ã€åˆæœŸãƒ­ãƒ¼ãƒ‰ãŒé€Ÿããªã‚Šã¾ã™ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ã€é•·ã„é–“ã€ç©ºç™½ã®ãƒ­ãƒ¼ãƒ‰ç”»é¢ã‚’è¦‹ã¤ã‚ã‚‹å¿…è¦ãŒãªããªã‚Šã¾ã™ã€‚ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¯ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒãƒ•ãƒªãƒ¼ã‚ºã—ã¦ã„ãªã„ã“ã¨ã‚’ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«çŸ¥ã‚‰ã›ã¾ã™ï¼šãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ã€ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒå‡¦ç†ã•ã‚Œå®Ÿè¡Œã•ã‚Œã‚‹ã¾ã§å°‘ã—å¾…ã¤å¿…è¦ãŒã‚ã‚‹ã ã‘ã§ã™ã€‚

```
Asset                             Size         Chunks            Chunk Names
emoji-picker.bundle.js           1.48 KiB      1    [emitted]    emoji-picker
main.bundle.js                   1.33 MiB      main [emitted]    main
vendors~emoji-picker.bundle.js   171 KiB       2    [emitted]    vendors~emoji-picker
```

å¾“æ¥ã¯åˆæœŸãƒãƒ³ãƒ‰ãƒ«ãŒ1.5MiBã ã£ãŸã®ã«å¯¾ã—ã€EmojiPickerã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚’åœæ­¢ã™ã‚‹ã“ã¨ã§ã€1.33MiBã«æ¸›ã‚‰ã™ã“ã¨ãŒã§ãã¾ã—ãŸ

ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§ã¯ã€EmojiPickerã‚’ãƒˆã‚°ãƒ«ã™ã‚‹ã¾ã§å®Ÿè¡Œã•ã‚Œãªã„ã“ã¨ãŒåˆ†ã‹ã‚Šã¾ã™
```javascript
import React, { Suspense, lazy } from "react";
// import Send from "./icons/Send";
// import Emoji from "./icons/Emoji";
const Send = lazy(() =>
import(/*webpackChunkName: "send-icon" */ "./icons/Send")
);
const Emoji = lazy(() =>
import(/*webpackChunkName: "emoji-icon" */ "./icons/Emoji")
);
// Lazy load EmojiPicker  when <EmojiPicker /> renders
const Picker = lazy(() =>
import(/*webpackChunkName: "emoji-picker" */ "./EmojiPicker")
);

const ChatInput = () => {
const [pickerOpen, togglePicker] = React.useReducer(state => !state, false);

    return (
      <Suspense fallback={<p id="loading">Loading...</p>}>
        <div className="chat-input-container">
          <input type="text" placeholder="Type a message..." />
          <Emoji onClick={togglePicker} />
          {pickerOpen && <Picker />}
          <Send />
        </div>
      </Suspense>
    );
};

console.log("ChatInput loaded", Date.now());

export default ChatInput;
```

ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ãƒ“ãƒ«ãƒ‰ã™ã‚‹ã¨ã€WebpackãŒä½œæˆã—ãŸã•ã¾ã–ã¾ãªãƒãƒ³ãƒ‰ãƒ«ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

EmojiPicker ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’å‹•çš„ã«ã‚¤ãƒ³ãƒãƒ¼ãƒˆã™ã‚‹ã“ã¨ã§ã€æœ€åˆã®ãƒãƒ³ãƒ‰ãƒ«ã‚µã‚¤ã‚ºã‚’ 1.5MiB ã‹ã‚‰ 1.33MiB ã«æ¸›ã‚‰ã™ã“ã¨ã«æˆåŠŸã—ã¾ã—ãŸ! EmojiPicker ãŒå®Œå…¨ã«ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã‚‹ã¾ã§ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ã¾ã ã—ã°ã‚‰ãå¾…ãŸãªã‘ã‚Œã°ãªã‚Šã¾ã›ã‚“ãŒã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ãƒ­ãƒ¼ãƒ‰ã‚’å¾…ã£ã¦ã„ã‚‹é–“ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã•ã‚Œã€ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ã«ãªã‚‹ã‚ˆã†ã«ã™ã‚‹ã“ã¨ã§ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¨ã‚¯ã‚¹ãƒšãƒªã‚¨ãƒ³ã‚¹ã‚’å‘ä¸Šã•ã›ã‚‹ã“ã¨ãŒã§ãã¾ã—ãŸã€‚

## ãƒ­ãƒ¼ãƒ€ãƒ–ãƒ«ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã¯ï¼ˆã¾ã ï¼‰React Suspenseã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã›ã‚“ã€‚React Suspenseã«ä»£ã‚ã‚‹ã‚‚ã®ã¨ã—ã¦ã€loadable-componentsãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒã‚ã‚Šã€SSRã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ä½¿ç”¨ã§ãã¾ã™ã€‚

```javascript
import React from "react";
import loadable from "@loadable/component";

import Send from "./icons/Send";
import Emoji from "./icons/Emoji";

const EmojiPicker = loadable(() => import("./EmojiPicker"), {
  fallback: <div id="loading">Loading...</div>
});

const ChatInput = () => {
  const [pickerOpen, togglePicker] = React.useReducer(state => !state, false);

  return (
    <div className="chat-input-container">
      <input type="text" placeholder="Type a message..." />
      <Emoji onClick={togglePicker} />
      {pickerOpen && <EmojiPicker />}
      <Send />
    </div>
  );
};

export default ChatInput;
```

React Suspense ã¨åŒæ§˜ã«ã€é…å»¶ã‚¤ãƒ³ãƒãƒ¼ãƒˆã•ã‚ŒãŸãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ loadable ã«æ¸¡ã™ã“ã¨ã§ã€EmojiPicker ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒãƒªã‚¯ã‚¨ã‚¹ãƒˆã•ã‚ŒãŸã¨ãã ã‘ã€ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¾ã™ ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¦ã„ã‚‹é–“ã€ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

loadable ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¯ SSR ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ React Suspense ã«ä»£ã‚ã‚‹ç´ æ™´ã‚‰ã—ã„æ–¹æ³•ã§ã™ãŒã€CSR ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã‚‚ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚’ä¸€æ™‚åœæ­¢ã™ã‚‹ãŸã‚ã«æœ‰ç”¨ã§ã™ã€‚
```javascript
import React from "react";
  import Send from "./icons/Send";
  import Emoji from "./icons/Emoji";
  import loadable from "@loadable/component";

  const EmojiPicker = loadable(() => import("./components/EmojiPicker"), {
    fallback: <p id="loading">Loading...</p>
  });

  const ChatInput = () => {
    const [pickerOpen, togglePicker] = React.useReducer(state => !state, false);

    return (
      <div className="chat-input-container">
        <input type="text" placeholder="Type a message..." />
        <Emoji onClick={togglePicker} />
        {pickerOpen && <EmojiPicker />}
        <Send />
      </div>
    );
  };

  console.log("ChatInput loaded", Date.now());

  export default ChatInput;
```