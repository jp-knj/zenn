---
title: "Webpack5ã§ã‚ˆãä½¿ã†ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ç´¹ä»‹"
emoji: "ğŸ•"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ['webpack', 'performance', 'ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹', 'æœ€é©åŒ–', 'treeshaking']
published: true 
---

# ã¯ã˜ã‚ã«
ãƒãƒ³ãƒ‰ãƒ«ã‚’æœ€é©ã«ã—ãŸã„å ´åˆã¯ã©ã†ã™ã‚Œã°ã‚ˆã„ã®ã§ã—ã‚‡ã†ã‹ï¼Ÿ
ãã‚Œã¯ã€**ãƒ—ãƒ©ã‚°ã‚¤ãƒ³**ã‚’æ´»ç”¨ã™ã‚‹ã“ã¨ã§ã™ã€‚

ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã¯ã€ãƒãƒ³ãƒ‰ãƒ«è‡ªä½“ã®ä½œæˆæ–¹æ³•ã‚’å¤‰æ›´ã™ã‚‹ã®ã«å½¹ç«‹ã¡ã¾ã™ã€‚

ä¾‹ãˆã°ã€`uglifyjs-webpack-plugin`ã¯ ãƒãƒ³ãƒ‰ãƒ«ã•ã‚ŒãŸJavascriptãƒ•ã‚¡ã‚¤ãƒ«ã‚’ minify (åœ§ç¸®) ã—ã¦ã€ãƒãƒ³ãƒ‰ãƒ«ã‚µã‚¤ã‚ºã‚’æœ€å°ã«æŠ‘ãˆã¦ãã‚Œã¾ã™ã€‚
ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã¯ã€`pluginsãƒ—ãƒ­ãƒ‘ãƒ†ã‚£`ã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã§ã€è¨­å®šã‚’è¿½åŠ ã—ã¦ãã‚Œã‚‹ã®ã§ã™ã€‚

## åœ§ç¸®ã¨è»½é‡åŒ–
ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ minify ã™ã‚‹ã“ã¨ã§ã€ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒãƒ³ãƒ‰ãƒ«ã‚µã‚¤ã‚ºãŒè»½é‡åŒ–ã‚„é€šä¿¡ã‚‚å‰Šæ¸›ã•ã‚Œã¾ã™ã€‚
åœ§ç¸®æ–¹æ³•ã¯æ˜å¿«ã§ã€`terser-webpack-plugin` ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚(webpack5ã§ã¯ãƒ“ãƒ«ãƒˆã‚¤ãƒ³ã•ã‚Œã¦ã„ã¾ã™ã€‚)

```typescript:example
import TerserPlugin from 'terser-webpack-plugin';

const config: webpack.Configuration = { 
    ...
    optimization: {
        minimizer: [
            new TerserPlugin({
                // ä¸¦åˆ—å‡¦ç†ã®å®Ÿè¡Œã‚’æœ‰åŠ¹åŒ–
                // åŒæ™‚ã«å®Ÿè¡Œã™ã‚‹ã‚’æ•°å€¤ã‚’è¨­å®š
                parallel: 4,
                // swcã‚’æœ‰åŠ¹åŒ–
                // minify: TerserPlugin.swcMinify,
                // Minify Optionsã‚’è¨­å®š
                terserOptions: {
                    // æœ€é©åŒ–
                    compress: {
                        ecma: 5,
                        warnings: false,
                        comparisons: false,
                        inline: 2,
                    },
                    // å¤‰æ•°åã‚’çŸ­ã
                    mangle: {
                        safari10: true,
                    },
                },
            }),
        ],
    },
    ...
};
```
**è¨­å®šã®è©³ç´°ã¯ã“ã¡ã‚‰**
https://webpack.js.org/plugins/terser-webpack-plugin/#terseroptions
https://terser.org/docs/api-reference

## ãƒãƒ³ãƒ‰ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’åˆ†é›¢
JavaScriptãƒ•ã‚¡ã‚¤ãƒ«ã¨CSSãƒ•ã‚¡ã‚¤ãƒ«ã‚’åˆ†é›¢ã™ã‚‹ã“ã¨ã§ã€JavaScriptãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒãƒ³ãƒ‰ãƒ«ã‚µã‚¤ã‚ºã‚’è»½é‡åŒ–ã—ã¦ãã‚Œã¾ã™ã€‚
webpack5ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã¯`mini-css-extract-plugin`ã‚’ä½¿ç”¨ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```typescript:example
import MiniCssExtractPlugin from "mini-css-extract-plugin";

const config: webpack.Configuration = {
    ...
    plugins: [
        new MiniCssExtractPlugin({
            filename:'style.[contenthash].css'
        }),
    ],
    ...
    module: {
    rules: [
      {
        test: /\.module\.scss$/,
        use: [
           MiniCssExtractPlugin. Loader,
          {
            loader: "css-loader",
          },
          {
            loader: "postcss-loader",
            options: {
              postcssOptions: {
                plugins: [["postcss-preset-env"]],
              },
            },
          },
          {
            loader: "thread-loader",
            options: {
              workerParallelJobs: 2,
            },
          },
          "sass-loader",
        ].filter(Boolean),
      },
    ],
  },
}
```
**è¨­å®šã®è©³ç´°ã¯ã“ã¡ã‚‰**
https://webpack.js.org/plugins/mini-css-extract-plugin/

### ãƒ–ãƒ©ã‚¦ã‚¶ã‚­ãƒ£ãƒƒã‚·ãƒ³ã‚°ã‚’ã—ã¦ã¿ã‚‹
ãƒ–ãƒ©ã‚¦ã‚¶ã‚­ãƒ£ãƒƒã‚·ãƒ³ã‚°ã¨ã¯ãƒ–ãƒ©ã‚¦ã‚¶ãŒCSSã‚„Javascriptãªã©ã®ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ã—ã€2å›ç›®ä»¥é™ã®èª­ã¿è¾¼ã¿ã‚’é«˜é€Ÿã«ã™ã‚‹ã®ã«å½¹ã«ç«‹ã¡ã¾ã™ã€‚

ã“ã‚Œã¯ã€ãƒ•ã‚¡ã‚¤ãƒ«åã«**ãƒãƒƒã‚·ãƒ¥ã‚­ãƒ¼**ã‚’æŒ‡å®šã™ã‚‹ã“ã¨ã§ã€ãƒ–ãƒ©ã‚¦ã‚¶ãŒãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’ç°¡å˜ã«ç”Ÿæˆã—ã¦ãã‚Œã¾ã™ã€‚
ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’è¿½åŠ ã™ã‚‹ã«ã¯ã€ãƒ•ã‚¡ã‚¤ãƒ«ã‚’åä»˜ã‘ã‚‹ã¨ãã« `[contenthash]ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰` ã‚’æŒ‡å®šã—ã¾ã™ã€‚

```typescript
output:{
    filename:'bundle.[contenthash].js',
    path:path.resolve(__dirname,'./dist'),
    publicPath:'/dist/'
},
plugins:[
    new MiniCSSExtractPlugin({
        filename:'style.[contenthash].css'
    })
]
```

### ãŠã¾ã‘
#### Tree shaking ã‚’ã—ã¦ã¿ã‚‹ 
Treeã€€shaking ã¯`dead code `(ä¸è¦ãªã‚³ãƒ¼ãƒ‰ã‚„æœªä½¿ç”¨ãªã‚³ãƒ¼ãƒ‰)ã‚’å–ã‚Šé™¤ãã“ã¨ã§ã™ã€‚

`dead code`ã®ç‰¹å¾´ã¨ã—ã¦
- ã‚³ãƒ¼ãƒ‰ãŒå®Ÿè¡Œã•ã‚Œãªã„
- å®Ÿè¡Œçµæœã¯æœªä½¿ç”¨
- èª­ã¿è¾¼ã¿ãŒã•ã‚Œãªã„ã€æ›¸ãè¾¼ã¿ã®ã¿ã®å¤‰æ•°

ãªã©ãŒæŒ™ã’ã‚‰ã‚Œã¾ã™ã€‚ã©ã†ã‚„ã£ã¦ã€ä¸Šè¨˜ã®ã‚³ãƒ¼ãƒ‰ã‚’å‰Šé™¤ã™ã‚‹ã®ã§ã—ã‚‡ã†ã‹ï¼Ÿ

`package.json`ã« sideEffects ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã«`false`ã‚’è¿½åŠ ã—ã¾ã—ã‚‡ã†
```json
{
  // å‰¯ä½œç”¨ã®ã‚ã‚‹ã‚³ãƒ¼ãƒ‰ã‚’ç„¡åŠ¹åŒ–
  "sideEffects": false
}
```
webpack ãŒæœªä½¿ç”¨ã® exportãªã©ã‚’å®‰å…¨ã«é™¤å¤–ã—ã¦ãã‚Œã¾ã™ã€‚
ã§ã™ãŒã€å‰¯ä½œç”¨ãŒã‚ã‚‹ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã¯ä½¿ç”¨ã§ããªããªã‚‹ã®ã§ å‰¯ä½œç”¨ãŒã‚ã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãªã©ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ãªã©ã«å¯¾ã—ã¦ã¯ä»¥ä¸‹ã®é€šã‚Šã«æ›¸ãå¿…è¦ãŒã‚ã‚Šãã†ã§ã™ã€‚

`package.json`ã«å‰¯ä½œç”¨ã‚’è¨±å®¹ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¿½åŠ ã—ã¾ã—ã‚‡ã†
```json
{
  // å‰¯ä½œç”¨ã®ã‚ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æœ‰åŠ¹åŒ–
  "sideEffects": [
    "./src/side-effects.ts",
    "./src/side-effects/**",
  ]
}

```
**å‚è€ƒæ–‡çŒ®**
https://webpack.js.org/guides/tree-shaking/#root