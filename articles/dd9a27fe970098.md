---
title: "<Card.Root> ã®ã‚ˆã†ã«å®Ÿè£…ã™ã¹ããªã®ã‹"
emoji: "ğŸ“‘"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: []
published: false
---
## ã¯ã˜ã‚ã«
`<Card.Root>`ã®ã‚ˆã†ãªè¨˜è¿°ã‚’è¦‹ã‹ã‘ã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚ã§ã™ãŒReact Server Componentã®æ–‡è„ˆã§ã¯ã€`<Card.Root>` ã®ã‚ˆã†ãªè¨˜è¿°ã¯é¿ã‘ã‚‹ã¹ãã¨ã•ã‚Œã¦ã„ã¾ã™ã€‚ãªãœã§ã—ã‚‡ã†ã‹ã€‚

`<Card.Root>`ã®ã‚ˆã†ãªè¨˜è¿°ã¯"dot"ã‚’ä½¿ç”¨ã—ã¦ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹æ–¹æ³•ã‚’æŒ‡ã—ã¾ã™ã€‚dot notationã¨å‘¼ã°ã‚Œã‚‹è¨˜æ³•ã§ã™ã€‚dot notationã«é–¢ã™ã‚‹issueã‚’è¦‹ã‹ã‘ãŸã®ã§ã€ä½•ãŒèµ·ãã¦ã„ã‚‹ã®ã‹ã‚’èª¿ã¹ã¦ã¿ã¾ã—ãŸã€‚

## ä»£è¡¨çš„ãªdot notationã®ä¾‹
ä¾‹ãˆã°ã€React Contextã‚’ä½¿ã£ãŸã¨ãã€`ThemeContext`ã¨ã„ã†ãƒˆãƒƒãƒ—ãƒ¬ãƒ™ãƒ«ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒã‚ã‚Šã€ãã‚Œã«é–¢é€£ã™ã‚‹ `Provider`ã¨ã„ã†ã‚µãƒ–ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒ`ThemeContext.Provider`ã®ã‚ˆã†ã«dotè¡¨è¨˜ã§å‚ç…§ã•ã‚Œã‚‹ã®ã§ã™ã€‚
```jsx
import { createContext, useContext } from 'react';

const Theme = createContext(null);

function App({ children }) {
    return (
        <ThemeContext.Provider value="dark">
            {children}
        </ThemeContext.Provider>
    );
}

function Header() {
    const theme = useContext(Theme);
    return <header style={{ color: theme === 'dark' ? 'white' : 'black' }}>Header</header>;
}
```

## dot notation ã§å®Ÿè£…ã‚’ã™ã‚‹ã¨ä½•ãŒèµ·ã“ã‚‹ã®ã‹
dot notationã§å®Ÿè£…ã‚’ã™ã‚‹ã¨ã€RSCã®æ–‡è„ˆã§å•é¡ŒãŒç™ºç”Ÿã—ã¾ã™ã€‚
ä¾‹ãˆã°ã€ä»¥ä¸‹ã®ã‚ˆã†ãªã‚³ãƒ¼ãƒ‰ãŒã‚ã‚‹ã¨ã—ã¾ã™ã€‚
```jsx
// components/card.tsx
function Card() {}

Card.Header = function Header() {}
Card.Body = function Body() {}
Card.Footer = function Footer() {}

export default Card;

// example/card.tsx
import { Card } from "../components/card"

export const BasedCard = () => {
    return (
        <Card>
            <Card.Body>
            </Card.Body>
            <Card.Footer justifyContent="flex-end" gap="2">
            </Card.Footer>
        </Card>
    )
}
```
ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºã®å•é¡ŒãŒç™ºç”Ÿã—ã¾ã™ã€‚ã“ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã¯React Server Componentsï¼ˆRSCï¼‰ã¨äº’æ›æ€§ã¯ãªã„ã®ã§ã™ã€‚ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹ã§ã—ã‚‡ã†ã€‚
https://github.com/facebook/react/blob/473522093d3dd95582729d01cd5c0d15dcc9cd3b/packages/react-server-dom-webpack/src/ReactFlightWebpackReferences.js#L188-L192

ä»¥ä¸‹ã®issueã§è­°è«–ã•ã‚Œã¦ã„ã¾ã™ã€‚
- ["Dot notation client component breaks consuming RSC"](https://github.com/vercel/next.js/issues/51593)
- ["This is probably a bug in the React Server Components bundler"](https://github.com/vercel/next.js/issues/58776)

Server Componentsã®å ´åˆã€`Card.Root` ã¯ `Card` ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¨ã—ã¦ã‚¢ã‚¯ã‚»ã‚¹ã•ã‚Œã¾ã™ã€‚ã—ã‹ã—ã€`Card` ã¯é–¢æ•°ã§ã‚ã‚Šã€JSONã«ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºã§ãã¾ã›ã‚“ã€‚ã“ã®ãŸã‚ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã™ã€‚
ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆè¦ç´ ã‚’æŒã£ã¦ã„ã‚‹å ´åˆã€`type`ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¯ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆé–¢æ•°ã‚’å‚ç…§ã—ã¾ã™ã€‚

ã™ã¹ã¦ã‚’æ­£ã—ãJSONã«å¤‰æ›ã™ã‚‹ãŸã‚ã«ã€Reactã¯ç‹¬è‡ªã®`replacer`é–¢æ•°ã‚’`JSON.stringify()`ã«æ¸¡ã—ã¦ã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆé–¢æ•°ã®å‚ç…§ã—ã¾ã™ã€‚

å…·ä½“çš„ã«ã¯ã€Reactè¦ç´ ãŒã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºã•ã‚Œã‚‹éš›ã«ä»¥ä¸‹ãŒè¡Œã‚ã‚Œã¾ã™ã€‚
1. åŸºæœ¬çš„ãªHTMLã‚¿ã‚°ï¼ˆtypeãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒã€Œ``div``ã€ã®ã‚ˆã†ãªæ–‡å­—åˆ—ï¼‰ã§ã‚ã‚Œã°ã€å‡¦ç†ã¯ä¸è¦ã§ã™ã€‚
2. Server Componentï¼ˆtypeãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«æ ¼ç´ã•ã‚Œã¦ã„ã‚‹ï¼‰ã‚’propsã§å‘¼ã³å‡ºã—ã€ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºã—ã¾ã™ã€‚Server ComponentãŒãƒ¬ãƒ³ãƒ€ãƒ¼ã•ã‚Œã€Server Componentã‚’åŸºæœ¬çš„ãªHTMLã‚¿ã‚°ã«å¤‰æ›ã™ã‚‹ã“ã¨ãŒç›®çš„ã§ã™ã€‚
3. Client Componentã®ã¨ãã¯ã€å‡¦ç†ã›ãšã¨ã‚‚ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºã§ãã¾ã™ã€‚typeãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¯å®Ÿéš›ã«ã¯ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å‚ç…§ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’æŒ‡ã—ã¦ãŠã‚Šã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆé–¢æ•°ã§ã¯ãªã„ãŸã‚ã§ã™ã€‚

https://github.com/facebook/react/blob/473522093d3dd95582729d01cd5c0d15dcc9cd3b/packages/react-server/src/ReactFlightServerTemporaryReferences.js#L71-L76

This example can still have similar tree-shaking issues as the first one.
Tree shaking works best when the code is structured in a way that allows the optimiser to statically analyse which parts of the code are unused. When we use Object.assign, we're dynamically attaching properties (Header, Body, and Footer) to the Card function. This makes it harder for many tree-shaking algorithms to determine that Header and Footer are unused because:
- Dynamic Property Assignment: Object.assign dynamically assigns properties to Card. Most tree-shaking tools rely on static analysis, and they might not "see through" the dynamic nature of this assignment.
- Module Boundaries: Tree shaking works more effectively when each function or component is imported separately. By bundling these components together using Object.assign, you're reducing the optimiser's ability to detect unused parts.

```jsx
export default Object.assign(Card, {
  Header,
  Footer,
});
```
https://github.com/react-bootstrap/react-bootstrap/blob/5cfa9895b52a68a6596cdea8822fffe985c0df66/src/Card.tsx#L105


```jsx
// card.tsx
export function CardRoot() {}
export function CardHeader() {}
export function CardFooter() {}

// namespace.ts 
export {
  CardBody as Body,
  CardRoot as Root,
  CardFooter as Footer,
  CardHeader as Header,
} from "./card";

// index.tsx
export * as Card from "./namespace";
```
https://github.com/chakra-ui/chakra-ui/tree/main/packages/react/src/components/card


```jsx
// index.tsx
export * as Card from "./namespace";
```
code-smell ã¨ã—ã¦ã€`export * as Card from "./namespace";` ã¯é¿ã‘ã‚‹ã¹ãã¨ã•ã‚Œã¦ã„ã¾ã™ã€‚

Avoid re-export all.
> Deeply nested import chains in modular projects, where a barrel file imports another barrel file, can lead to increased load times and complexity. [çœç•¥]

### å‚è€ƒ
1. https://biomejs.dev/linter/rules/no-re-export-all/
2. https://github.com/thepassle/eslint-plugin-barrel-files/blob/main/docs/rules/avoid-re-export-all.md
3. https://e18e.dev/guide/speedup.html

https://rollupjs.org/repl/?version=4.21.1&shareable=JTdCJTIyZXhhbXBsZSUyMiUzQW51bGwlMkMlMjJtb2R1bGVzJTIyJTNBJTVCJTdCJTIyY29kZSUyMiUzQSUyMiUyRiUyRiUyMFRSRUUtU0hBS0lORyU1Q25pbXBvcnQlMjAqJTIwYXMlMjBDYXJkJTIwZnJvbSUyMCcuJTJGZm5zLmpzJyUzQiU1Q24lNUNuY29uc29sZS5sb2coQ2FyZC5CYXIpJTNCJTIyJTJDJTIyaXNFbnRyeSUyMiUzQXRydWUlMkMlMjJuYW1lJTIyJTNBJTIybWFpbi5qcyUyMiU3RCUyQyU3QiUyMmNvZGUlMjIlM0ElMjJleHBvcnQlMjBjb25zdCUyMEZvbyUyMCUzRCUyMCgpJTIwJTNEJTNFJTIwNDIlNUNuZXhwb3J0JTIwY29uc3QlMjBCYXIlMjAlM0QlMjAoKSUyMCUzRCUzRSUyMDk5JTIyJTJDJTIyaXNFbnRyeSUyMiUzQWZhbHNlJTJDJTIybmFtZSUyMiUzQSUyMmZucy5qcyUyMiU3RCU1RCUyQyUyMm9wdGlvbnMlMjIlM0ElN0IlMjJvdXRwdXQlMjIlM0ElN0IlMjJmb3JtYXQlMjIlM0ElMjJlcyUyMiU3RCUyQyUyMnRyZWVzaGFrZSUyMiUzQXRydWUlN0QlN0Q=
