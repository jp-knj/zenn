---
title: "Astro コンパイラ & レンダリング内部"
---


> この章のゴール  
> - `.astro → HTML/JS/CSS` へいたるビルド & SSR パスをコードで追跡できる  
> - プラグインや独自レンダラーを書く際のフック位置を把握できる  
> - OSS 初コントリビュートに必要な実戦的知識を得る  

## 4.0 序章：なぜ内部を知るのか
### 4.0.1 “魔法” を解体するメリット
### 4.0.2 最小サンプルの準備 ★

## 4.1 アーキテクチャ全体像
### 4.1.1 三層モデル（Compiler／Runtime Core／Vite Plugin）
### 4.1.2 処理フローと主要データ構造（Mermaid 図）

## 4.2 コンパイラパイプライン
### 4.2.1 Parser フェーズ ★  
#### 4.2.1.1 シンタックスサポート（Astro・MDX・JSX）  
#### 4.2.1.2 AST ノード型一覧
### 4.2.2 Transform フェーズ ★  
#### 4.2.2.1 フロントマター抽出  
#### 4.2.2.2 Slot・Props・Imports の正規化  
#### 4.2.2.3 静的解析と最適化パス
### 4.2.3 Codegen フェーズ ★  
#### 4.2.3.1 `<astro-island>` ラッパー生成  
#### 4.2.3.2 Virtual Module とエイリアス発行  
#### 4.2.3.3 Source Map と診断情報

## 4.3 Vite 連携レイヤ
### 4.3.1 `vite-plugin-astro` のフック順序 ★
### 4.3.2 チャンク分割 & 共有ランタイム抽出
### 4.3.3 HMR・差分ビルドの流れ

## 4.4 サーバーサイドレンダリング
### 4.4.1 `renderPage()` 呼び出し階層
### 4.4.2 レンダラー `check()` 判定の仕組み ★
### 4.4.3 `renderToStaticMarkup()` で発火する SSR

## 4.5 ハイドレーションメタデータ
### 4.5.1 `<astro-island>` 属性一覧 ★
### 4.5.2 戦略タグ（client:load / visible …）の付与箇所

## 4.6 エラー処理 & デバッグ
### 4.6.1 コンパイラ診断メッセージ生成
### 4.6.2 Source Map 再マッピング ★
### 4.6.3 DevTools 連携とログレベル設定

## 4.7 拡張ポイント
### 4.7.1 独自レンダラー雛形を作る ★
### 4.7.2 AST 変換プラグイン試作（リンクカード自動置換）

## 4.8 パフォーマンス考察
### 4.8.1 AST 最適化 vs Vite Tree-Shake
### 4.8.2 並列／インクリメンタルビルドの課題

## 4.9 まとめ & 次章ブリッジ
### 4.9.1 学びの要点 3 行まとめ
### 4.9.2 「05 章 Multi-Framework Magic」への接続

```