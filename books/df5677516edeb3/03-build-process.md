---
title: "第3章: ビルドの仕組み：静的HTML生成の舞台裏"
---

# 第3章: ビルドの仕組み：静的HTML生成の舞台裏

## 【この章で学ぶこと】

アイランドアーキテクチャを実現するための最初のステップは、ブラウザに渡すファイルを事前に準備する「ビルドプロセス」です。この章では、`.astro`ファイルや各種フレームワークのコンポーネントが、どのようにして最適化された静的なHTML、CSS、そして最小限のJavaScriptに変換されるのか、その詳細なステップを解き明かします。このビルドプロセスを理解することは、Astroがなぜ「デフォルトでZero-JS」を実現できるのかを知るための鍵となります。

---

## 1. 【実装】静的生成パイプラインの内部

Astroのビルドプロセスは、プロジェクト内のソースファイルを包括的に解析することから始まります。この解析フェーズでは、Astroファイルだけでなく、React、Vue、Svelteなど、`astro.config.mjs`に登録されたインテグレーションを通じてサポートされるすべてのフレームワークのコンポーネントファイルが検出対象となります。

ファイルが検出されると、次に各コンポーネントに対応する「レンダラー」が特定されます。例えば、ファイルがReactのJSX構文を含んでいればReactレンダラーが選ばれ、その`renderToStaticMarkup`のようなサーバーサイドレンダリング用の関数が呼び出されます。この関数は各フレームワークの標準的な機能（例えばReactでは`ReactDOMServer.renderToString()`）を利用しており、コンポーネントを純粋なHTML文字列に変換します。この段階ではクライアントサイド専用のフック、例えばReactの`useEffect`などは実行されず、安全に初期HTMLが生成されることが保証されています。

インタラクティブな「島」としてマークされたコンポーネントに対しては、ビルドプロセスは特別な処理を行います。後のハイドレーションで必要となる情報をすべて属性として持つ、`<astro-island>`というカスタム要素でそのコンポーネントの初期HTMLをラップします。この時、コンポーネントに渡されるpropsは、単純な`JSON.stringify`では扱えないDateオブジェクトやRegExpなども処理できる、Astro独自の直列化システムによって安全に文字列化されます。

最終的に、Astroは内部でViteを呼び出し、これらの処理を経て生成されたHTMLや、島のためのJavaScriptチャンクをバンドルします。Viteの強力なTree Shaking機能により、島で使われていないReactのフック（例えば`useContext`）などは最終的なバンドルから除去され、各島のJavaScriptサイズは最小限に抑えられます。この一連の流れが、Astroの高速なサイト生成の根幹を成しているのです。

---

## 2. 【まとめと次章へ】

この章では、Astroがソースコードを解析し、最適化された静的ファイルを生成するまでのビルドプロセスの流れを解説しました。サーバーサイドで可能な限りの処理を完了させることが、Astroの高速化の秘訣です。

次章では、こうして生成されたファイルがブラウザに読み込まれた後、どのようにしてインタラクティブ性を取り戻すのか、「実行時の仕組みとハイドレーション」について詳しく見ていきます。