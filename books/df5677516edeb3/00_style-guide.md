# Crafting Interpreters 型

## 目的

Astro の核心技術を自ら実装できるほどに読みやすく、わかりやすい技術書を目指し、文章構造・語り口・実装手順・コード規約を統一する。本ガイドは著者・レビュワー・自動 CI が共有する唯一の基準となる。各章原稿は必ずこの指針に従うこと。

## 適用範囲

* `re-astro-book/` 配下の Markdown ファイル
* `examples/` 以下の解答コード
* CI のテキスト lint ルール

## 章構成に関する指針

### 再実装の視点

Astro の機能を「利用者の立場」ではなく「自分がゼロから作るならどう設計するか」という視点で語る。各章の中心は「選択肢の比較 → 採用理由 → 実装」の順で展開し、読者が「なぜそう作られているのか」を理解できる深さまで掘り下げる。

### 前章との連続性

各章の冒頭で前章の成果物と残された課題を振り返り、読者が現在地を把握できるようにする。目安は 3 段落以内。

> 例：
> 前回はパーサを実装し、ソースを AST に変換できるようになった。しかし HTML 生成器が存在しないため、ブラウザには何も表示されない。次に進むには AST を実際のマークアップへ翻訳する仕組みが不可欠である。

### 基本ロジック

- なぜ失敗しているのか（問題の輪郭）
- 何が不足しているのか（必要部品の明示）
- どう解決するのか（道筋の提示）

### 一次情報の引用

公式ドキュメント、仕様書、リポジトリのコードや PR など一次情報を必ず根拠として引用する。引用はインラインリンクか脚注で示し、二次情報のみを根拠にしてはいけない。

### 読了時間と文字数の目安

- 理論章 約 10 分 / 2500〜3000 字
- 実装章 15〜20 分 / 3500〜4000 字
- 応用章 20 分 / 4000〜4500 字

CI で文字数と想定読了時間を自動検証する。

## 失敗ファーストのアプローチ

### 素朴実装をまず提示

「動かないコード」または「性能が出ないコード」を意図的に示し、なぜ問題が生じるかを読者と共に確認する。コメントで原因を短く補足すること。

```typescript
// 動かない例 — hydrate がフレームワークを判別できない
function hydrate(component: unknown) {
  if ((component as any).type === 'react') {
    ReactDOM.hydrate(component);
  }
}
```

### エラーメッセージの共有

実際のスタックトレースを引用ブロックで示し、その内容を文章で解釈する。

> TypeError: Cannot read property 'type' of undefined

## 段階的実装プロセス

まとめて全てを組まず、3 段階で構築する。

1. 最小動作 — 成功体験を最速で得る。
2. 機能追加 — 実用レベルへ拡張する。
3. 最適化 — 性能と可読性を改善し、プロダクション水準へ引き上げる。

各ステップは 400 字程度の解説と対応するコード例を配置する。

## 語り口

- 一人称は「私たち」。読者をペアとして迎える。
- 文体は敬体（です・ます）。
- 技術用語は英語原語を用いるが、それ以外の英語表現は避ける。
- セクション末尾で疑問形を用いて次節へ誘導すると効果的。
- 比喩は「海と島」「エンジン」など視覚を喚起するものに限り、必ず技術的洞察を添える。

## コードと Markdown 規約

- 言語 TypeScript 5 以上、`strict` を有効化。
- コメント 英語。50 文字以内に収める。JSDoc は公開 API のみ必須。
- コードブロック 言語名を明示する（ts, tsx, bash など）。
- テーブル 使用しない。比較は箇条書きで示す。
- 画像 必要最小限とし、`/assets/{chapterId}/diagram.png` に保存する。本文で参照する際は「図」とキャプションを付ける。

## 学習支援コンテンツ

* 注意書き `> 注意:` 形式で記述。
* 補足情報 `> 補足:` 形式で記述。
* 落とし穴 `> 落とし穴:` 形式で記述。

## 次章への布石

まだ解決していない課題を示し、次章で扱うことを予告。

## 用語集（抜粋）

* Hydration（ハイドレーション）: DOM に JavaScript を結合する工程。
* Island（島）: ページ内で局所的に対話性を持つ DOM 片。
* RAG（検索強化生成）: Retrieval‑Augmented Generation。

用語は追加が必要になった時点で本節に追記する。